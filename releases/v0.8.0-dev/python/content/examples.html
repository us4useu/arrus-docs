

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples &mdash; ARRUS (python) 0.8.0-dev20230425 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="api.html" />
    <link rel="prev" title="User Guide" href="user_guide.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> ARRUS (python)
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="definitions.html">Glossary and assumptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_guide.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#plane-wave-imaging">Plane Wave Imaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="#classical-beamforming">Classical Beamforming</a></li>
<li class="toctree-l2"><a class="reference internal" href="#diverging-beams">Diverging Beams</a></li>
<li class="toctree-l2"><a class="reference internal" href="#others">Others</a></li>
<li class="toctree-l2"><a class="reference internal" href="#check-probe">Check probe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#current-features">Current features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#methods-of-evaluation">Methods of evaluation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-the-script">How to use the script</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="misc/acknowledgments.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc/release_notes.html">Release notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ARRUS (python)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<p>In the following parts of this chapter, we will show you how to run example
scripts available in the ARRUS software. The source code of the ready-to-run
examples can be found in python/examples directory.</p>
<p>For more information on the parameters of individual functions please refer
to section <a class="reference internal" href="api.html#arrus-api"><span class="std std-ref">API Reference</span></a>.</p>
<p>For the user guide and all the assumptions (e.g. about the coordinate system)
please visit sections <a class="reference internal" href="definitions.html#arrus-definitions"><span class="std std-ref">Glossary and assumptions</span></a> and <a class="reference internal" href="user_guide.html#arrus-user-guide"><span class="std std-ref">User Guide</span></a>.</p>
<p>Before running any of the below examples:</p>
<ul class="simple">
<li><p>Make sure you are running the Python script using the appropriate Python distribution;
please install python/examples/requirements.txt file first (if you haven’t already that done).</p></li>
<li><p>Make sure you are using correct configuration file. See <a class="reference internal" href="user_guide.html#arrus-running-scheme"><span class="std std-ref">Running the Scheme</span></a> for more information how the path to configuration file is determined when creating session object.</p></li>
<li><p>Make sure that the correct parameters are set, in particular the transmitting voltage.</p></li>
</ul>
<div class="section" id="plane-wave-imaging">
<h2>Plane Wave Imaging<a class="headerlink" href="#plane-wave-imaging" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Go to python/examples directory.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">plane_wave_imaging.py</span></code></p></li>
</ol>
<p>This script implements ‘plane wave imaging’ scheme,
where the image is formed by combining a couple low-resolution images into one high-resolution image.
Each low-resolution image is formed using data acquired after transmission of a plane wave at a different angle.
After starting the script, you should be able to see an output similar to the below one:</p>
<div class="figure align-default" id="id1">
<img alt="../_images/bmode_pwi_phantom_cysts.png" src="../_images/bmode_pwi_phantom_cysts.png" />
<p class="caption"><span class="caption-number">Fig. 3 </span><span class="caption-text">Plane wave imaging python script output. Phantom: ATS549, cysts. Probe: L14-5/38 from Ultrasonix.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="classical-beamforming">
<h2>Classical Beamforming<a class="headerlink" href="#classical-beamforming" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Go to python/examples directory.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">classical_beamforming.py</span></code></p></li>
</ol>
<p>This script implements classical transmit-receive scheme, where the image is formed using line by line scanning.
After starting the script, you should be able to see an output image similar to the below one:</p>
<div class="figure align-default" id="id2">
<img alt="../_images/bmode_bfr_phantom_cysts.png" src="../_images/bmode_bfr_phantom_cysts.png" />
<p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">Classical beamforming script output image. Phantom: ATS549, cysts. Probe: L14-5/38 from Ultrasonix.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="diverging-beams">
<h2>Diverging Beams<a class="headerlink" href="#diverging-beams" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Go to python/examples directory.</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">diverging_beams.py</span></code></p></li>
</ol>
<p>This script implements diverging beams transmit-receive scheme,
where the image is formed using data acquired after couple transmissions of diverging beams
with different virtual focuses.
After starting the script, you should be able to see an output image similar to the below one:</p>
<div class="figure align-default" id="id3">
<img alt="../_images/bmode_div_phantom_cysts.png" src="../_images/bmode_div_phantom_cysts.png" />
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">Diverging beams scheme script output image. Phantom: ATS549, cysts. Probe: L14-5/38 from Ultrasonix.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="others">
<h2>Others<a class="headerlink" href="#others" title="Permalink to this headline">¶</a></h2>
<p>The /examples directory contain addtional scripts <code class="docutils literal notranslate"><span class="pre">custom_callback.py</span></code> and <code class="docutils literal notranslate"><span class="pre">custom_tx_rx_sequence.py</span></code>
which show how to construct custom sequences and callbacks.</p>
</div>
<div class="section" id="check-probe">
<h2>Check probe<a class="headerlink" href="#check-probe" title="Permalink to this headline">¶</a></h2>
<p>Sometimes some of the transducers in the probe can be damaged, e.g. mechanically.
Such a damaged transducer can be potentially dangerous to the system,
e.g. it can cause mismatched current flow in some subsystem and damage it.
This example consists of a python script (arrus/api/python/examples/check_probe.py)
evaluating transducers in ultrasound probe.
The evaluation is made on the basis of values of features
estimated from signals acquired by each transducer.
The transmit-receive scheme includes transmitting by single transducer
and receiving by transducers in aperture centered on the transmitter.
It is assumed that there are lens on transducers,
and the probe is <em>in the air</em>, thus the analysed signal
comes from reflection at the lens-air interface.
Each transducer is excited by a short (single period) and low voltage (10V).</p>
<div class="section" id="current-features">
<h3>Current features<a class="headerlink" href="#current-features" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>amplitude</p></li>
<li><p>pulse duration</p></li>
<li><p>energy of normalised signal</p></li>
<li><dl class="simple">
<dt>pearson correlation coefficient (PCC) with <em>footprint</em> signal</dt><dd><p>PCC require a footprint (i.e. object containing reference rf signal array).
The footprint should be acquired earlier using the same setup.
This feature measure how much the signals changed comparing to footprint.
When transducer is broken, the acquired signal should be different comparing
to signal acquired before damage.</p>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="methods-of-evaluation">
<h3>Methods of evaluation<a class="headerlink" href="#methods-of-evaluation" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><dl class="simple">
<dt><strong>Threshold</strong></dt><dd><p>It bases on the values of features estimated
from signals acquired from examined transducer.
If the value is outside predefined range, the corresponding transducer is
treated as <em>suspected</em>.
These ranges can be set in FeatureDescriptor() calls
in the main() function of the script (below “# define features list”).
This ranges can differs between probes.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><strong>Neighborhood</strong></dt><dd><p>It bases on the values of features estimated
from signals acquired from examined transducer and transducers
in close neighborhood.
If the value from the examined transducer differs
from the values from other transducers by more then arbitrary percentage,
the transducer is treated as <em>suspected</em>.
Note, that PCC should be validated using threshold method
(i.e. usign ByThresholdValidator()).</p>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="how-to-use-the-script">
<h3>How to use the script<a class="headerlink" href="#how-to-use-the-script" title="Permalink to this headline">¶</a></h3>
<p>The script is called from command line with some options.
At the end of its run, the scripts (optionally) display figures with values of
the features, and initial segments of signals from all transducer, for visual
evaluation.</p>
<p>Following options are accepted:</p>
<p><strong>required</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">cfg_path</span><span class="p">:</span> <span class="n">path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">system</span><span class="s1">&#39;s configuration file,</span>
</pre></div>
</div>
<p><strong>optional</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">help</span><span class="p">:</span> <span class="n">displays</span> <span class="n">help</span><span class="p">,</span>
<span class="o">--</span><span class="n">method</span><span class="p">:</span> <span class="n">determines</span> <span class="n">which</span> <span class="n">method</span> <span class="n">will</span> <span class="n">be</span> <span class="n">used</span> <span class="o">-</span> <span class="s1">&#39;threshold&#39;</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;neighborhood&#39;</span><span class="p">,</span>
<span class="o">--</span><span class="n">rf_file</span><span class="p">:</span> <span class="n">determines</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">optional</span> <span class="n">output</span> <span class="n">file</span> <span class="k">with</span> <span class="n">rf</span> <span class="n">data</span><span class="p">,</span>
<span class="o">--</span><span class="n">display_frame</span><span class="p">:</span> <span class="n">determines</span> <span class="k">if</span> <span class="n">script</span> <span class="n">will</span> <span class="n">display</span> <span class="n">figures</span> <span class="k">for</span> <span class="n">visual</span> <span class="n">evaluation</span><span class="p">,</span>
<span class="o">--</span><span class="n">n</span><span class="p">:</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">full</span> <span class="n">Tx</span> <span class="n">cycles</span> <span class="n">to</span> <span class="n">run</span> <span class="p">(</span><span class="n">default</span> <span class="mi">8</span><span class="p">),</span>
<span class="o">--</span><span class="n">tx_frequency</span><span class="p">:</span> <span class="n">determines</span> <span class="n">transmit</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Hz</span><span class="p">]</span> <span class="p">(</span><span class="n">default</span> <span class="mf">8e6</span><span class="p">),</span>
<span class="o">--</span><span class="n">nrx</span><span class="p">:</span> <span class="n">determines</span> <span class="n">the</span> <span class="n">size</span> <span class="n">of</span> <span class="n">receiving</span> <span class="n">aperture</span> <span class="p">(</span><span class="n">default</span> <span class="mi">32</span><span class="p">),</span>
<span class="o">--</span><span class="n">create_footprint</span><span class="p">:</span> <span class="n">creates</span> <span class="n">footprint</span> <span class="ow">and</span> <span class="n">store</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">given</span> <span class="n">pickle</span> <span class="n">file</span><span class="p">,</span>
<span class="o">--</span><span class="n">use_footprint</span><span class="p">:</span> <span class="n">determines</span> <span class="n">which</span> <span class="n">footprint</span> <span class="n">file</span> <span class="n">to</span> <span class="n">use</span><span class="p">,</span>
<span class="o">--</span><span class="n">display_summary</span><span class="p">:</span> <span class="n">displays</span> <span class="n">features</span> <span class="n">values</span> <span class="n">on</span> <span class="n">figure</span><span class="p">,</span>
<span class="o">--</span><span class="n">show_pulse_comparison</span><span class="p">:</span> <span class="n">displays</span> <span class="n">acquired</span> <span class="n">pulse</span> <span class="ow">and</span> <span class="n">corresponding</span> <span class="n">footprint</span> <span class="n">signal</span>
<span class="o">--</span><span class="n">features</span><span class="p">:</span> <span class="n">features</span> <span class="n">to</span> <span class="n">evaluation</span> <span class="p">(</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">pcc</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Examples</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">check_probe</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span>
<span class="n">python</span> <span class="n">check_probe</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">cfg_path</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">us4r</span><span class="o">.</span><span class="n">prototxt</span>
<span class="n">python</span> <span class="n">check_probe</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">cfg_path</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">us4r</span><span class="o">.</span><span class="n">prototxt</span> <span class="o">--</span><span class="n">rf_file</span> <span class="n">rf</span><span class="o">.</span><span class="n">pkl</span>
<span class="n">python</span> <span class="n">check_probe</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">cfg_path</span> <span class="o">~/</span><span class="n">us4r</span><span class="o">.</span><span class="n">prototxt</span> <span class="o">--</span><span class="n">create_footprint</span> <span class="n">footprint</span><span class="o">.</span><span class="n">pkl</span> <span class="o">--</span><span class="n">n</span><span class="o">=</span><span class="mi">16</span>
<span class="n">python</span> <span class="n">check_probe</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">cfg_path</span> <span class="o">~/</span><span class="n">us4r</span><span class="o">.</span><span class="n">prototxt</span> <span class="o">--</span><span class="n">use_footprint</span> <span class="n">footprint</span><span class="o">.</span><span class="n">pkl</span>
<span class="n">python</span> <span class="n">check_probe</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">cfg_path</span> <span class="o">~/</span><span class="n">us4r</span><span class="o">.</span><span class="n">prototxt</span> <span class="o">--</span><span class="n">use_footprint</span> <span class="n">footprint</span><span class="o">.</span><span class="n">pkl</span> <span class="o">--</span><span class="n">features</span> <span class="n">amplitude</span> <span class="n">pcc</span>
</pre></div>
</div>
<p><strong>Additional notes:</strong></p>
<p>1. This script tries to identify channels it considers suspicious.
In the case of a suspicious channel, the user should verify it manually
(i.e. to look on the signal from the channel and decide, if it is good or not),
because the features used are only indicative.</p>
<p>2. Some features (like pulse duration) are more <em>sensitive</em> than the others,
i.e. are more likely to give false positives.
If there are a lot of false positives one can remove the feature from the list
of features to verify.</p>
<p>3. Using of threshold method assume that one know the range of values
of verified features.
These ranges often are different for different probes.
If one do not know the feature range of values, the neighborhood method can be used.</p>
<p>4. The use of probe footprint seems to be the most convenient, however it require
to create a footprint (using –create_footprint option).
It assume, that all channels are ok during footprint creation, and later it
just indentify channels where signals not match with the footprint.
Thus, when some channel is damaged during footprint creation, it may be undetected
on later tests.</p>
<p>5. Remember to set proper <em>tx_frequency</em> (using –tx_frequency) when create a footprint
or making tests without it
(when footprint is used, tx/rx scheme parameters will be taken from it).</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="user_guide.html" class="btn btn-neutral float-left" title="User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2023, us4us Ltd.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>